<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<link rel="stylesheet" th:href="@{/css/header.css}">
	<link rel="stylesheet" th:href="@{/css/footer.css}">
	<link rel="stylesheet" th:href="@{/css/join.css}">
	<title>Metaway join</title>
</head>

<header th:replace="~{/include/header.html}"></header>
<join-body>
	<div class="join-form">
    <h1><span>JOIN</span></h1>
    <form action="/join" method="post">
		
		<div class="join-box">
			<img src="images/user.png">			
        	<input type="text" id="account" name="account" class="input-area" required placeholder="your id">
       	 <span></span>
		</div>
		
		<div class="join-box">
	    	<img src="images/pwd.png">
	  		<input type="password" id="password" name="password" required placeholder="your password">
		</div>
		
		<div class="join-box">
		    <img src="images/email.png">
		    <input type="email" id="email" name="email" required placeholder="your email">
		    <button type="button" id="sendVerificationEmail">인증요청</button>
		
		    <!-- 이메일 전송 성공 시, 인증 칸을 보이게 설정 -->
		    <div id="emailVerificationBox" style="display:none;">
		        <input type="text" id="emailVerificationCode" placeholder="Enter Verification Code" required />
		        <button type="button" id="emailVerificationBtn">인증</button>
		        <span class="verificationResult"></span>
		    </div>
		
		    <span class="successEmailChk"></span>
		</div>

		
		<div class="join-box">
			<img src="images/user.png">	
       		 <input type="text" id="name" name="name" placeholder="your name">
        </div>
		
		<div class="join-box">
		    <img src="images/phone.png">  
				<input type="phone" id="phone" name="phone" required placeholder="your phone">
		</div>
		              
		<div class="join-box">
			<img src="images/birth.png">	
        		<input type="text" id="age" name="age" placeholder="your age">
        </div>
        
		<div class="join-box">
			<img src="images/address.png">	
       		 <input type="text" id="address" name="address" placeholder="your address">
         </div>      
        <button type="submit" class="submit-btn">SIGN IN</button>
    </form>
	</div>
    
    <!-- footer include -->
	<footer th:replace="~{/include/footer.html}"></footer>
	
	
<script>
    $(document).ready(function () {
        $("#sendVerificationEmail").click(function () {
            var email = $("#email").val();
            $.ajax({
                type: "POST",
                url: "/user/mailSend",
                contentType: "application/json",
                data: JSON.stringify({
                    email: email
                }),
                success: function (response) {
                    alert("Verification email sent successfully!");
                    $(".successEmailChk").text("Verification email sent successfully!");
                    $(".successEmailChk").css("color", "green");
                    // 이메일 전송 성공 시, 인증 칸을 보이게 설정
                    $("#emailVerificationBox").show();
                },
                error: function (error) {
                    alert("Error sending verification email: " + error.responseText);
                    $(".successEmailChk").text("Error sending verification email. Please try again.");
                    $(".successEmailChk").css("color", "red");
                }
            });
        });

        // 이메일 인증번호 대조
        $("#emailVerificationBtn").click(function () {
            var enteredCode = $("#emailVerificationCode").val();
            $.ajax({
                type: "POST",
                url: "/user/verifyCode",
                data: {
                    usercode: enteredCode
                },
                success: function (response) {
                    $(".verificationResult").text(response);
                    $(".verificationResult").css("color", "green");
                },
                error: function (error) {
                    $(".verificationResult").text(error.responseText);
                    $(".verificationResult").css("color", "red");
                }
            });
        });
    });
</script>


    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

    <script>
        includeHTML();
    </script>

</joinbody>
</html>