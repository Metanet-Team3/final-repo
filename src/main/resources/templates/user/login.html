<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<link rel="stylesheet" th:href="@{/css/header.css}">
	<link rel="stylesheet" th:href="@{/css/footer.css}">
	<link rel="stylesheet" th:href="@{/css/login.css}">
	<title>Metaway login</title>
</head>

<header th:replace="~{/include/header.html}"></header>
<body>
    <div id="app" class="login-form">
            
				    <h1><span>LOGIN</span></h1>
                <form v-if="isLoginFormVisible" @submit.prevent="login">
					
					<div class="login-box">
					<img src="images/user.png">		
                    <input type="text" placeholder="username" v-model="account"/>
					</div>
					
					<div class="login-box">
					<img src="images/pwd.png">	
                    <input type="password" placeholder="password" v-model="password"/>
                    </div>
                    
                    <button type="submit" class="login-btn">login</button>
                    <button  class="join-btn">join</button>
                </form>
            
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script>
	new Vue({
	    el: '#app',
	    data: {
	        isLoginFormVisible: true,
	        account: '',
	        password: ''
	    },
	    methods: {
	        login() {
	            console.log('Logging in:', this.account, this.password);
	
	            const url = '/login'; 
				const formData = new FormData();
				formData.append('account', this.account);
				formData.append('password', this.password);
				
				fetch(url, {
				    method: 'POST',
				    body: formData
				})
				.then(response => {
				    if (response.ok) {
				        const authorizationHeader = response.headers.get('Authorization');
				        const token = authorizationHeader ? authorizationHeader.replace('Bearer ', '') : null;

				        sessionStorage.setItem('token', token);
				        console.log('Token login:', token); 

				        window.location.href = '/'; 
				        console.log('로오오오그의ㅣ니이인ㄴ');
				    } else {
				        console.error('시리ㅣ잉이ㅣㅣㄹ패');
				    }
				})
				.catch(error => {
				    console.error('Error logging in:', error);
				});

	        }
	    }
	});

    </script>
        <!-- footer include -->
	<footer th:replace="~{/include/footer.html}"></footer>
</body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
</html>
