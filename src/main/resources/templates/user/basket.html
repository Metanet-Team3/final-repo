<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
	<link rel="stylesheet" th:href="@{/css/header.css}">
	<link rel="stylesheet" th:href="@{/css/footer.css}">
	<link rel="stylesheet" th:href="@{/css/basket.css}">
	<title>Document</title>
</head>

<header th:replace="/include/header.html"></header>

<body>
	<div id="wrap">
		<div id="mainBox">
			<form method="post" action="/order">
				<div id="productBox">
					<div id="AllProduct">
						<div class="productInfoBox" th:each="pro, proindex : ${product}">
							<input type="hidden" th:value="${pro.productId}" th:name="'contractList[' +  ${proindex.index} + '].productId'">
							<input type="hidden" th:name="'contractList[' + ${proindex.index} + '].contractId'" th:value="${pro.contractId}">
							<div id="imageBox">
								<img th:src="'data:' + ${pro.imageType} + ';base64,' + ${pro.imageFile}"
									id="productImage">
							</div>
							<div id="ProductTextBox">
								<div th:text="${pro.productModel}" class="modelText">모델명</div>
								<div th:text="${pro.productName}" class="nameText">이름명</div>
								<div th:if="${pro.contractYear != 0}" th:text="${pro.contractYear} + '년 약정'"
									class="YearText1">약정</div>
								<div th:if="${pro.contractYear == 0}" class="YearText2">즉시 구매</div>
								<div th:if="${pro.contractYear != 0}" th:text="'월 ' + ${pro.contractPrice} + '원'" th:data-price="${pro.contractPrice}"
									class="priceText1"></div>
								<div th:if="${pro.contractYear == 0}" th:text="${pro.contractPrice} + '원'" th:data-price="${pro.contractPrice}"
									class="priceText2"></div>
							</div>
						</div>
					</div>
					<div id="buttonBox">
						<div id="buttonText">
							<div class="AllpriceText">렌탈료 합계 <sapn class="priceValue1">11</sapn></div>
							<div class="AllpriceText">결제금액 합계 <span class="priceValue2">11</span></div>
						</div>
						<div class="d-grid gap-2" id="buttonBottom">
							<button class="btn btn-primary">구입하기</button>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
</body>
<footer th:replace="/include/footer.html"></footer>
<script>
	
	
window.addEventListener('DOMContentLoaded', (event) => {
    var rental = document.querySelectorAll('.priceText1');
    var buy = document.querySelectorAll('.priceText2');
    var rentalPrice = 0;
    var buyPrice = 0;

    rental.forEach(item => {
        rentalPrice += parseFloat(item.getAttribute('data-price')); // 문자열을 숫자로 변환
    });

    buy.forEach(item => {
        buyPrice += parseFloat(item.getAttribute('data-price'));
    });

    var rentalValue = document.querySelector('.priceValue1'); // 수정된 부분
    var buyValue = document.querySelector('.priceValue2'); // 수정된 부분

    if (rentalValue) rentalValue.textContent = '월 ' + rentalPrice + '원';// 요소가 존재하는 경우에만 textContent 설정
    if (buyValue) buyValue.textContent = buyPrice + '원';
});
</script>

</html>